function doPost(e) {
  try {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sheet = ss.getActiveSheet();

    const nome = e.parameter.nome;
    const telefone = e.parameter.telefone;
    const lance = parseFloat(e.parameter.lance);
    const camisa = e.parameter.camisa;

    if (!nome || !telefone || isNaN(lance) || !camisa) {
      return ContentService
        .createTextOutput(JSON.stringify({ status: 'erro', mensagem: 'Dados inválidos' }))
        .setMimeType(ContentService.MimeType.JSON);
    }

    const timestamp = new Date();

    // Adiciona a nova linha com a data/hora na primeira coluna
    sheet.appendRow([timestamp, nome, telefone, lance, camisa]);

    return ContentService
      .createTextOutput(JSON.stringify({ status: 'sucesso', mensagem: 'Lance enviado com sucesso!' }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({ status: 'erro', mensagem: error.message }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet() {
  try {
    const ss = SpreadsheetApp.getActiveSpreadsheet();
    const sheet = ss.getActiveSheet();
    const data = sheet.getDataRange().getValues();

    let highestGremio = 0;
    let highestInter = 0;

    // Começa da linha 2 (índice 1), já que a linha 1 é cabeçalho
    for (let i = 1; i < data.length; i++) {
      const camisa = data[i][4]?.toString().toLowerCase().trim(); // Coluna E (índice 4)
      const lance = parseFloat(data[i][3]); // Coluna D (índice 3)

      if (!isNaN(lance)) {
        if (camisa === 'grêmio' || camisa === 'gremio') {
          if (lance > highestGremio) highestGremio = lance;
        } else if (camisa === 'inter' || camisa === 'internacional') {
          if (lance > highestInter) highestInter = lance;
        }
      }
    }

    return ContentService
      .createTextOutput(JSON.stringify({
        status: 'sucesso',
        gremio: highestGremio,
        inter: highestInter
      }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({ status: 'erro', mensagem: error.message }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}
